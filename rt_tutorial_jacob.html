<!DOCTYPE html>
<html>
<head>
  <title>Language Study</title>
  <!-- Load JsPsych -->
  <script src="https://unpkg.com/jspsych@7.3.3"></script>
  <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
  <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.4"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
 
</head>
<body>
  <script src="stims.js"></script>
  <script>
    // Initialize jsPsych
    const jsPsych = initJsPsych({
        // TODO: add a progress bar showing how far the experiment has progressed
        show_progress_bar: true,
      on_finish: function() {
        // Displays data at the end of the experiment
        // Better to comment out for the real experiment so participants aren't confused
        jsPsych.data.displayData();
      }
    });


    // We will store each trial in a list called timeline 
    const timeline = [];

    // Instructions
    const instructions = {
      //TODO: Fill in the parameters here for a plugin which displays some instructions. 
      // Tell the participants they will be reading one word at a time, and pressing
      // the spacebar to advance to the next word. 
      type: jsPsychInstructions,
      pages: ['<div class="content"><h2>Instructions</h2>' +
                '<p>You will be reading one word at a time, and pressing' +
                'the </strong>spacebar</strong> to advance to the next word.</p></div>' +
                '<p>Press the <strong>SPACEBAR</strong> to begin.</p>'
              ],
      show_clickable_nav: true,
    };
    timeline.push(instructions);

    // Function to create reading trials for a sentence
    function createReadingTrials(sentence, sentenceNum, condition){
      const trials = [];
      
    //   //TODO: Add a trial showing a fixation cross briefly, before each sentence 
      const fixation = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '<div style="font-size: 72px;">+</div>',
        choices: "NO_KEYS",
        trial_duration: 500
      };
      trials.push(fixation);
    //   //TODO:  Add a trial showing a message telling the participant to press the spacebar to begin the sentence
      const startSentencePrompt = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '<div>Press the spacebar to begin reading the sentence.</div>',
        choices: [' '],
      };
      trials.push(startSentencePrompt);
    //   // Loops over every word in the sentence 
    //   // Each word is its own trial 
      for (let i = 0; i < sentence.length; i++) {
        if (condition === "Upper Bound") {
            trials.push({
                type: jsPsychHtmlKeyboardResponse,
                stimulus: '',
                choices: "NO_KEYS",
                trial_duration: 50
            });
        }
        trials.push({
          type: jsPsychHtmlKeyboardResponse,
          stimulus: sentence[i], 
          choices: [' '],
          data: {
                word: sentence[i],
                word_position: i + 1,
                sentence_number: sentenceNum,
                condition: condition
              }
        });
      }
      return trials;
    }
    
    const shuffledStimuli = experimentStimuli.sort(() => Math.random() - 0.5);

    for (let i = 0; i < shuffledStimuli.length; i++) {
        const stimulus = shuffledStimuli[i];
        const readingTrials = createReadingTrials(stimulus.sentence, i + 1, stimulus.condition);
        timeline.push(...readingTrials);
    }
       
            // TODO: FIll me in the plugin parameters here! 
            // The plugin should display a word on each trial, 
            // and then advance to the next word when the spacebar is pressed.
            // Make sure the trial saves: 
            // The word displayed & the participant Reaction Time, PLUS:
            // The number of the sentence and the number of the word in the sentence

    // // TODO: Shuffle the presentation order of the sentences 
    
    // // Add reading trials for each sentence
    // Nice to tell participants they are done, thank you, etc
    timeline.push({
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '<div>Thank you for your participation!</div>',
        choices: "ALL_KEYS",
        on_finish: function() {
            jsPsych.data.displayData();
        } 
    });

    // This line actually runs the experiment 
    jsPsych.run(timeline);
  </script>
</body>
</html>